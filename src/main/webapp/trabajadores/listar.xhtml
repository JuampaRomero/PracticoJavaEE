<!DOCTYPE html>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="jakarta.faces.html"
                xmlns:f="jakarta.faces.core"
                xmlns:ui="jakarta.faces.facelets"
                xmlns:p="http://primefaces.org/ui"
                template="/templates/main-template.xhtml">
    
    <ui:define name="title">Listado de Trabajadores - Gestor de Identidades</ui:define>
    
    <ui:define name="content">
        <h:form id="form">
            <!-- Header con título y botón de agregar -->
            <div class="flex justify-between items-center mb-6">
                <div>
                    <h1 class="text-3xl font-bold text-gray-900">Trabajadores de Salud</h1>
                    <p class="text-gray-600 mt-1">Gestiona la información de todos los trabajadores del sistema</p>
                </div>
                <h:commandButton value="Nuevo Trabajador" 
                                 action="registrar"
                                 styleClass="btn btn-primary">
                    <i class="fas fa-plus mr-2"></i>
                </h:commandButton>
            </div>
            
            <!-- Mensajes -->
            <p:messages id="messages" showDetail="true" closable="true" styleClass="mb-4">
                <p:autoUpdate/>
            </p:messages>
            
            <!-- Card con DataTable -->
            <div class="modern-card p-0">
                <p:dataTable id="dt-trabajadores" 
                             value="#{trabajadorBean.trabajadores}" 
                             var="trabajador"
                             filteredValue="#{trabajadorBean.trabajadoresFiltrados}"
                             paginator="true" 
                             rows="10"
                             paginatorPosition="bottom"
                             paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                             currentPageReportTemplate="Mostrando {startRecord}-{endRecord} de {totalRecords} trabajadores"
                             rowsPerPageTemplate="5,10,20,50"
                             globalFilterOnly="true"
                             emptyMessage="No se encontraron trabajadores"
                             styleClass="modern-datatable">
                    
                    <!-- Header con búsqueda global -->
                    <f:facet name="header">
                        <div class="flex justify-between items-center p-4">
                            <span class="text-xl font-semibold text-gray-800">
                                <i class="fas fa-users mr-2 text-blue-500"></i>
                                Lista de Trabajadores
                            </span>
                            <div class="flex items-center gap-3">
                                <!-- Búsqueda Global -->
                                <span class="p-input-icon-left">
                                    <i class="pi pi-search"></i>
                                    <p:inputText id="globalFilter" 
                                                 onkeyup="PF('dtTrabajadores').filter()" 
                                                 placeholder="Buscar en todos los campos..."
                                                 styleClass="w-64"/>
                                </span>
                                
                                <!-- Botón para limpiar filtros -->
                                <p:commandButton value="Limpiar" 
                                                 icon="pi pi-filter-slash"
                                                 styleClass="p-button-secondary"
                                                 onclick="PF('dtTrabajadores').clearFilters()"/>
                            </div>
                        </div>
                    </f:facet>
                    
                    <!-- Columnas con filtros individuales -->
                    <p:column headerText="Cédula" sortBy="#{trabajador.cedula}" filterBy="#{trabajador.cedula}" 
                              filterMatchMode="contains" styleClass="font-mono">
                        <h:outputText value="#{trabajador.cedula}"/>
                    </p:column>
                    
                    <p:column headerText="Nombre Completo" sortBy="#{trabajador.nombre} #{trabajador.apellido}" 
                              filterBy="#{trabajador.nombre} #{trabajador.apellido}" filterMatchMode="contains">
                        <h:outputText value="#{trabajador.nombre} #{trabajador.apellido}" 
                                      styleClass="font-semibold text-gray-800"/>
                    </p:column>
                    
                    <p:column headerText="Especialidad" sortBy="#{trabajador.especialidad}" 
                              filterBy="#{trabajador.especialidad}" filterMatchMode="equals">
                        <f:facet name="filter">
                            <p:selectOneMenu onchange="PF('dtTrabajadores').filter()" 
                                           styleClass="custom-filter">
                                <f:selectItem itemLabel="Todas" itemValue="#{null}" noSelectionOption="true"/>
                                <f:selectItems value="#{trabajadorBean.especialidades}" var="esp"
                                             itemLabel="#{esp}" itemValue="#{esp}"/>
                            </p:selectOneMenu>
                        </f:facet>
                        <span class="px-3 py-1 text-sm font-medium rounded-full bg-blue-100 text-blue-800">
                            #{trabajador.especialidad}
                        </span>
                    </p:column>
                    
                    <p:column headerText="Matrícula" sortBy="#{trabajador.matriculaProfesional}" 
                              filterBy="#{trabajador.matriculaProfesional}" filterMatchMode="contains">
                        <h:outputText value="#{trabajador.matriculaProfesional}"/>
                    </p:column>
                    
                    <p:column headerText="Fecha Ingreso" sortBy="#{trabajador.fechaIngreso}">
                        <h:outputText value="#{trabajador.fechaIngreso}" styleClass="text-gray-600">
                            <f:convertDateTime pattern="dd/MM/yyyy" type="localDate"/>
                        </h:outputText>
                    </p:column>
                    
                    <p:column headerText="Estado" sortBy="#{trabajador.activo}" 
                              filterBy="#{trabajador.activo}" filterMatchMode="equals">
                        <f:facet name="filter">
                            <p:selectOneMenu onchange="PF('dtTrabajadores').filter()" 
                                           styleClass="custom-filter">
                                <f:selectItem itemLabel="Todos" itemValue="#{null}" noSelectionOption="true"/>
                                <f:selectItem itemLabel="Activo" itemValue="true"/>
                                <f:selectItem itemLabel="Inactivo" itemValue="false"/>
                            </p:selectOneMenu>
                        </f:facet>
                        <span class="#{trabajador.activo ? 'px-3 py-1 text-sm font-medium rounded-full bg-green-100 text-green-800' : 'px-3 py-1 text-sm font-medium rounded-full bg-red-100 text-red-800'}">
                            <i class="fas #{trabajador.activo ? 'fa-check-circle' : 'fa-times-circle'} mr-1"></i>
                            #{trabajador.activo ? 'Activo' : 'Inactivo'}
                        </span>
                    </p:column>
                    
                    <p:column headerText="Acciones" exportable="false" styleClass="text-center">
                        <p:commandButton icon="pi pi-eye" 
                                       title="Ver detalles"
                                       styleClass="p-button-rounded p-button-text p-button-info"
                                       oncomplete="PF('dlgDetalle').show()"
                                       update=":form:detalle-content"
                                       process="@this">
                            <f:setPropertyActionListener value="#{trabajador}" 
                                                       target="#{trabajadorBean.trabajadorSeleccionado}"/>
                        </p:commandButton>
                    </p:column>
                    
                    <!-- Footer con resumen -->
                    <f:facet name="footer">
                        <div class="p-4 bg-gray-50 text-sm text-gray-600">
                            Total de trabajadores: <span class="font-semibold text-gray-800">#{trabajadorBean.trabajadores.size()}</span>
                        </div>
                    </f:facet>
                </p:dataTable>
            </div>

            
            <!-- Diálogo de detalles -->
            <p:dialog header="Detalles del Trabajador" 
                      widgetVar="dlgDetalle" 
                      modal="true" 
                      showEffect="fade" 
                      hideEffect="fade" 
                      responsive="true"
                      width="600"
                      styleClass="modern-dialog">
                <p:outputPanel id="detalle-content" styleClass="p-4">
                    <div class="grid grid-cols-2 gap-4" rendered="#{not empty trabajadorBean.trabajadorSeleccionado}">
                        <div>
                            <label class="font-semibold text-gray-700 block mb-1">Cédula:</label>
                            <p class="text-gray-900">#{trabajadorBean.trabajadorSeleccionado.cedula}</p>
                        </div>
                        <div>
                            <label class="font-semibold text-gray-700 block mb-1">Nombre Completo:</label>
                            <p class="text-gray-900">#{trabajadorBean.trabajadorSeleccionado.nombre} #{trabajadorBean.trabajadorSeleccionado.apellido}</p>
                        </div>
                        <div>
                            <label class="font-semibold text-gray-700 block mb-1">Especialidad:</label>
                            <p class="text-gray-900">#{trabajadorBean.trabajadorSeleccionado.especialidad}</p>
                        </div>
                        <div>
                            <label class="font-semibold text-gray-700 block mb-1">Matrícula Profesional:</label>
                            <p class="text-gray-900">#{trabajadorBean.trabajadorSeleccionado.matriculaProfesional}</p>
                        </div>
                        <div>
                            <label class="font-semibold text-gray-700 block mb-1">Fecha de Ingreso:</label>
                            <p class="text-gray-900">
                                <h:outputText value="#{trabajadorBean.trabajadorSeleccionado.fechaIngreso}">
                                    <f:convertDateTime pattern="dd/MM/yyyy" type="localDate"/>
                                </h:outputText>
                            </p>
                        </div>
                        <div>
                            <label class="font-semibold text-gray-700 block mb-1">Estado:</label>
                            <p class="#{trabajadorBean.trabajadorSeleccionado.activo ? 'text-green-600 font-semibold' : 'text-red-600 font-semibold'}">
                                #{trabajadorBean.trabajadorSeleccionado.activo ? 'Activo' : 'Inactivo'}
                            </p>
                        </div>
                    </div>
                </p:outputPanel>
            </p:dialog>
        </h:form>
        

    </ui:define>
</ui:composition>
