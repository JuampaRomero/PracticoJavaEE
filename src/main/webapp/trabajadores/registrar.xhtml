<!DOCTYPE html>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="jakarta.faces.html"
                xmlns:f="jakarta.faces.core"
                xmlns:ui="jakarta.faces.facelets"
                xmlns:p="http://primefaces.org/ui"
                template="/templates/main-template.xhtml">
    
    <ui:define name="title">Registrar Trabajador - Gestor de Identidades</ui:define>
    
    <ui:define name="content">
        <h:form id="form">
            <!-- Header -->
            <div class="mb-6">
                <h1 class="text-3xl font-bold text-gray-900">Registrar Nuevo Trabajador</h1>
                <p class="text-gray-600 mt-1">Complete el formulario para agregar un nuevo trabajador de salud al sistema</p>
            </div>
            
            <!-- Mensajes -->
            <p:messages id="messages" showDetail="true" closable="true" styleClass="mb-4">
                <p:autoUpdate/>
            </p:messages>
            
            <!-- Formulario principal -->
            <div class="modern-card max-w-4xl mx-auto">
                <div class="card-header">
                    <h2 class="card-title">
                        <i class="fas fa-user-plus text-blue-500 mr-2"></i>
                        Información del Trabajador
                    </h2>
                </div>
                
                <p:panel styleClass="border-0">
                    <!-- Grid de campos -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- Cédula -->
                        <div class="form-group">
                            <p:outputLabel for="cedula" value="Cédula de Identidad *" styleClass="form-label"/>
                            <p:inputText id="cedula" 
                                         value="#{trabajadorBean.nuevoTrabajador.cedula}" 
                                         required="true"
                                         requiredMessage="La cédula es obligatoria"
                                         styleClass="form-control"
                                         placeholder="Ej: 12345678">
                                <p:ajax event="blur" update="cedula-msg"/>
                                <f:validateLength minimum="8" maximum="10"/>
                            </p:inputText>
                            <p:message for="cedula" id="cedula-msg" display="icon"/>
                        </div>
                        
                        <!-- Nombre -->
                        <div class="form-group">
                            <p:outputLabel for="nombre" value="Nombre *" styleClass="form-label"/>
                            <p:inputText id="nombre" 
                                         value="#{trabajadorBean.nuevoTrabajador.nombre}" 
                                         required="true"
                                         requiredMessage="El nombre es obligatorio"
                                         styleClass="form-control"
                                         placeholder="Ej: Juan">
                                <p:ajax event="blur" update="nombre-msg"/>
                                <f:validateLength minimum="2" maximum="50"/>
                            </p:inputText>
                            <p:message for="nombre" id="nombre-msg" display="icon"/>
                        </div>
                        
                        <!-- Apellido -->
                        <div class="form-group">
                            <p:outputLabel for="apellido" value="Apellido *" styleClass="form-label"/>
                            <p:inputText id="apellido" 
                                         value="#{trabajadorBean.nuevoTrabajador.apellido}" 
                                         required="true"
                                         requiredMessage="El apellido es obligatorio"
                                         styleClass="form-control"
                                         placeholder="Ej: Pérez">
                                <p:ajax event="blur" update="apellido-msg"/>
                                <f:validateLength minimum="2" maximum="50"/>
                            </p:inputText>
                            <p:message for="apellido" id="apellido-msg" display="icon"/>
                        </div>
                        
                        <!-- Especialidad -->
                        <div class="form-group">
                            <p:outputLabel for="especialidad" value="Especialidad *" styleClass="form-label"/>
                            <p:selectOneMenu id="especialidad" 
                                             value="#{trabajadorBean.nuevoTrabajador.especialidad}"
                                             required="true"
                                             requiredMessage="Debe seleccionar una especialidad"
                                             styleClass="form-control">
                                <f:selectItem itemLabel="-- Seleccione una especialidad --" 
                                              itemValue="" noSelectionOption="true"/>
                                <f:selectItems value="#{trabajadorBean.especialidades}" 
                                               var="esp" 
                                               itemLabel="#{esp}" 
                                               itemValue="#{esp}"/>
                                <p:ajax event="change" update="especialidad-msg"/>
                            </p:selectOneMenu>
                            <p:message for="especialidad" id="especialidad-msg" display="icon"/>
                        </div>
                        
                        <!-- Matrícula Profesional -->
                        <div class="form-group">
                            <p:outputLabel for="matricula" value="Matrícula Profesional *" styleClass="form-label"/>
                            <p:inputNumber id="matricula" 
                                           value="#{trabajadorBean.nuevoTrabajador.matriculaProfesional}"
                                           required="true"
                                           requiredMessage="La matrícula profesional es obligatoria"
                                           styleClass="form-control"
                                           placeholder="Ej: 12345"
                                           decimalPlaces="0"
                                           thousandSeparator=""
                                           minValue="1"
                                           maxValue="999999">
                                <p:ajax event="blur" update="matricula-msg"/>
                            </p:inputNumber>
                            <p:message for="matricula" id="matricula-msg" display="icon"/>
                        </div>
                        
                        <!-- Fecha de Ingreso -->
                        <div class="form-group">
                            <p:outputLabel for="fechaIngreso" value="Fecha de Ingreso *" styleClass="form-label"/>
                            <p:datePicker id="fechaIngreso" 
                                          value="#{trabajadorBean.nuevoTrabajador.fechaIngreso}"
                                          required="true"
                                          requiredMessage="La fecha de ingreso es obligatoria"
                                          pattern="dd/MM/yyyy"
                                          showIcon="true"
                                          showOnFocus="false"
                                          styleClass="w-full"
                                          placeholder="dd/mm/aaaa"
                                          maxdate="#{trabajadorBean.nuevoTrabajador.fechaIngreso}">
                                <p:ajax event="dateSelect" update="fechaIngreso-msg"/>
                            </p:datePicker>
                            <p:message for="fechaIngreso" id="fechaIngreso-msg" display="icon"/>
                        </div>
                        
                        <!-- Estado -->
                        <div class="form-group col-span-2">
                            <p:outputLabel value="Estado" styleClass="form-label mb-3 block"/>
                            <p:selectBooleanCheckbox id="activo" 
                                                     value="#{trabajadorBean.nuevoTrabajador.activo}"
                                                     itemLabel="Trabajador Activo">
                                <p:ajax update="estado-text"/>
                            </p:selectBooleanCheckbox>
                            <h:outputText id="estado-text" 
                                          value="#{trabajadorBean.nuevoTrabajador.activo ? 'El trabajador estará activo en el sistema' : 'El trabajador estará inactivo en el sistema'}" 
                                          styleClass="ml-3 text-sm text-gray-600"/>
                        </div>
                    </div>
                    
                    <!-- Información adicional -->
                    <div class="mt-6 p-4 bg-blue-50 rounded-lg">
                        <div class="flex items-start">
                            <i class="fas fa-info-circle text-blue-500 mt-1 mr-3"></i>
                            <div class="text-sm text-blue-800">
                                <p class="font-semibold mb-1">Información importante:</p>
                                <ul class="list-disc list-inside space-y-1">
                                    <li>Todos los campos marcados con (*) son obligatorios</li>
                                    <li>La cédula debe ser única en el sistema</li>
                                    <li>La fecha de ingreso no puede ser futura</li>
                                    <li>Verifique que todos los datos sean correctos antes de guardar</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Botones de acción -->
                    <div class="flex justify-end gap-3 mt-6 pt-6 border-t border-gray-200">
                        <p:commandButton value="Cancelar" 
                                         action="listar"
                                         immediate="true"
                                         styleClass="p-button-secondary"
                                         icon="pi pi-times">
                        </p:commandButton>
                        
                        <p:commandButton value="Limpiar Formulario" 
                                         type="reset"
                                         styleClass="p-button-warning"
                                         icon="pi pi-refresh"
                                         actionListener="#{trabajadorBean.prepararNuevoTrabajador}"
                                         update="@form">
                        </p:commandButton>
                        
                        <p:commandButton value="Guardar Trabajador" 
                                         action="#{trabajadorBean.guardarTrabajador}"
                                         styleClass="p-button-success"
                                         icon="pi pi-save"
                                         validateClient="true"
                                         update="@form">
                        </p:commandButton>
                    </div>
                </p:panel>
            </div>
            
            <!-- Panel de validación en tiempo real -->
            <div class="mt-6 max-w-4xl mx-auto">
                <p:panel header="Estado de Validación" 
                         toggleable="true" 
                         collapsed="true"
                         styleClass="modern-card">
                    <div class="grid grid-cols-2 gap-4 text-sm">
                        <div class="flex items-center">
                            <i class="pi #{empty trabajadorBean.nuevoTrabajador.cedula ? 'pi-times text-red-500' : 'pi-check text-green-500'} mr-2"></i>
                            <span>Cédula ingresada</span>
                        </div>
                        <div class="flex items-center">
                            <i class="pi #{empty trabajadorBean.nuevoTrabajador.nombre ? 'pi-times text-red-500' : 'pi-check text-green-500'} mr-2"></i>
                            <span>Nombre ingresado</span>
                        </div>
                        <div class="flex items-center">
                            <i class="pi #{empty trabajadorBean.nuevoTrabajador.apellido ? 'pi-times text-red-500' : 'pi-check text-green-500'} mr-2"></i>
                            <span>Apellido ingresado</span>
                        </div>
                        <div class="flex items-center">
                            <i class="pi #{empty trabajadorBean.nuevoTrabajador.especialidad ? 'pi-times text-red-500' : 'pi-check text-green-500'} mr-2"></i>
                            <span>Especialidad seleccionada</span>
                        </div>
                        <div class="flex items-center">
                            <i class="pi #{empty trabajadorBean.nuevoTrabajador.matriculaProfesional ? 'pi-times text-red-500' : 'pi-check text-green-500'} mr-2"></i>
                            <span>Matrícula profesional</span>
                        </div>
                        <div class="flex items-center">
                            <i class="pi #{empty trabajadorBean.nuevoTrabajador.fechaIngreso ? 'pi-times text-red-500' : 'pi-check text-green-500'} mr-2"></i>
                            <span>Fecha de ingreso</span>
                        </div>
                    </div>
                </p:panel>
            </div>
        </h:form>
    </ui:define>
</ui:composition>
